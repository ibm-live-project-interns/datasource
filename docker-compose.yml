# docker-compose.yml â€” Datasource service standalone deployment
#
# This compose file runs the datasource service as an individual container
# that connects to the main orchestration network (prod_org-network).
# It is designed to be used alongside the infra/prod docker-compose.yml
# which manages Kafka, PostgreSQL, and other shared infrastructure.
#
# Usage:
#   docker-compose up --build
#
# Prerequisites:
#   - The prod_org-network must already exist (created by infra/prod/docker-compose.yml)
#   - Kafka and the ingestor service should be running on that network
#
# NOTE: This file references the uppercase "Dockerfile" (ujjwal's multi-stage
# build without CGO). If you need the Kafka-native build with CGO/librdkafka,
# you would need to modify the Dockerfile accordingly.

version: '3.8'

services:
  datasource:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: prod-datasource-manual
    networks:
      - prod_org-network
    environment:
      # Kafka broker address (matches infra/prod Kafka service)
      - KAFKA_BROKER=kafka:9092

      # Ingestor HTTP endpoint for health checks and direct event delivery
      - INGESTOR_CORE_URL=http://ingestor:8080

      # Runtime environment (dev/staging/prod)
      - ENV=dev
    volumes:
      # Mount local config directory for YAML-based simulator configuration
      - ./config:/app/config

# Connect to the shared orchestration network managed by infra/prod.
# This network must be created externally before starting this service.
networks:
  prod_org-network:
    external: true
